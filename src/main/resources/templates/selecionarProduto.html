<!DOCTYPE html>
<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:th="http://www.thymeleaf.org"
  lang="pt-br"
>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9"
      crossorigin="anonymous"
    />
    <title>Pizzaria</title>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" th:href="@{/listarProdutos}">Novo pedido</a>
        </li>
        <li
          class="nav-item"
          th:if="${pedido != null && #lists.size(pedido.itensPedido) > 0}"
        >
          <a class="nav-link" th:href="@{/confirmarPedido}">Finalizar pedido</a>
        </li>
      </ul>
    </nav>

    <table>
      <thead>
        <tr>
          <th>Nome</th>
          <th>Descrição</th>
          <th>Valor</th>
          <th>Ação</th>
        </tr>
      </thead>

      <tbody>
        <tr th:each="produto: ${produtos}">
          <td th:text="${produto.nome}"></td>
          <td th:text="${produto.descricao}"></td>
          <td
            th:text="'R$' + ' ' + ${#numbers.formatDecimal(produto.valor,1,'POINT',2,'COMMA')}"
          ></td>
          <td>
            <a th:href="@{/selecionaProduto(codigo=${produto.codigo})}"
              >Selecionar</a
            >
          </td>
        </tr>
      </tbody>
    </table>

    <div th:if="${produtoSelecionado}" style="margin-top: 25px">
      <table>
        <caption>
          Produto selecionado
        </caption>
        <thead>
          <tr>
            <th>Nome</th>
            <th>Descrição</th>
            <th>Valor</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td th:text="${produtoSelecionado.nome}"></td>
            <td th:text="${produtoSelecionado.descricao}"></td>
            <td
              th:text="'R$' + ' ' + ${#numbers.formatDecimal(produtoSelecionado.valor,1,'POINT',2,'COMMA')}"
            ></td>
          </tr>
        </tbody>
      </table>

      <form
        method="POST"
        th:object="${itemPedido}"
        th:action="@{/incluirNoPedido}"
        style="margin-top: 25px"
      >
        <div th:if="${produtoSelecionado.tipo == 'pizza'}">
          <label for="tamanhos">Tamanho</label>

          <select th:field="*{tamanho}" id="tamanhos">
            <option value="Pequena">Pequena</option>
            <option value="Média">Média</option>
            <option value="Grande">Grande</option>
          </select>
        </div>

        <div th:if="${produtoSelecionado.tipo == 'bebida'}">
          <label for="tamanhos">Tamanho</label>

          <select th:field="*{tamanho}" id="tamanhos">
            <option value="250ml">250ml</option>
            <option value="500ml">500ml</option>
            <option value="1L">1L</option>
            <option value="2L">2L</option>
          </select>
        </div>

        <div>
          <label for="quantidade">Quantidade</label>
          <input
            th:field="*{quantidade}"
            type="number"
            min="1"
            th:onchange="'calculateValue()'"
            required
          />
        </div>

        <div>
          <span>Valor total: R$ </span>
          <input
            style="border: none; outline: none"
            type="text"
            th:field="${produtoSelecionado.valor}"
            readonly
          />
        </div>

        <button>Incluir no pedido</button>
      </form>
    </div>

    <script th:inline="javascript">
      const pValorTotal = document.querySelector("#valor");
      const valorTotal = pValorTotal.value;

      function calculateValue() {
        const quantidade = document.querySelector("#quantidade").value;

        pValorTotal.value = `${(
          Number(valorTotal) * Number(quantidade)
        ).toFixed(2)}`;
      }

      calculateValue();
    </script>
  </body>
</html>
